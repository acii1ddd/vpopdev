services:
  master:
    image: postgres:17.0
    ports:
      - 5433:5432
    environment:
      POSTGRES_PASSWORD: 123
    volumes:
      - ${PWD}/pgdata-master:/var/lib/postgresql/data
      - ${PWD}/00_init.sql:/docker-entrypoint-initdb.d/00_init.sql
    command: > 
       postgres -c wal_level=replica
               -c max_wal_senders=10
               -c max_replication_slots=10
               -c hot_standby=on
 
    networks:
      - devpops2
  
  slave:
    image: postgres:17.0
    environment:
      POSTGRES_PASSWORD: 123
    ports:
      - 5434:5432
    volumes:
      - ${PWD}/pgdata-slave:/var/lib/postgresql/data
    networks:
      - devpops2

networks:
  devpops2:
    driver: bridge

# host    replication     replicator      0.0.0.0/0               md5
# pg_basebackup -h master -p 5432 -U replicator -D /data/ -Fp -Xs -R
# docker exec -it postgres-1 bash
# # create a new user
# createuser -U postgresadmin -P -c 5 --replication replicationUser
# exit


# -e POSTGRES_USER=postgresadmin `
# -e POSTGRES_PASSWORD=admin123 `
# -e POSTGRES_DB=postgresdb `
# -e PGDATA="/data" `
# -v ${PWD}/pgdata:/data `
# -v ${PWD}/config:/config `
# -p 5000:5432 `
# хуйня ебанная
# postgres:15.0 -c 'config_file=/config/postgresql.conf'